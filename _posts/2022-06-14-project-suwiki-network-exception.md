---
layout: post
title: "[SUWIKI] ë¬¸ì œ í•´ê²° - ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ í•¸ë“¤ë§"
subtitle: Sandwichë¥¼ ì‚¬ìš©í•œ ë„¤íŠ¸ì›Œí‚¹ í•¸ë“¤ë§ ğŸ¥ª
categories: Project
tags: [suwiki,network,exception,error]
---

## ë¬¸ì œ ë°œìƒ

---

ì˜ ë™ì‘í•˜ë˜ ì•±ì´ ê°‘ìê¸° ì¼œìë§ˆì ì•±ì´ ì£½ì–´ë²„ë¦¬ëŠ” ë²„ê·¸ê°€ ë°œìƒí–ˆë‹¤. ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ë‹ˆ ë„¤íŠ¸ì›Œí‚¹ì„ í•˜ë˜ ì¤‘ ì£½ì€ ê²ƒ ê°™ì€ë° ì‘ë‹µì„ ë°›ì§€ ëª»í•œ ìƒíƒœë¡œ í„°ì§„ ê²ƒì„ í™•ì¸í–ˆë‹¤.

ì›ì¸ì„ íŒŒì•…í•´ë³´ë‹ˆ Base URLë¡œ ì‚¬ìš©í•˜ë˜ ì£¼ì†Œê°€ ì¶©ëŒì„ ì¼ìœ¼í‚¤ë©´ì„œ `UnKnownHostException`ê°€ ë°œìƒí•œ ê²ƒì´ë‹¤.

Suwiki ì•ˆë“œë¡œì´ë“œ ì•±ì€ ì•±ì„ ì¼œë©´ ìë™ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•œ í›„ `true`ë¼ë©´ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°›ì•„ì˜¨ë‹¤. ë˜í•œ ì‹œê°„í‘œ ë²„ì „ì„ í™•ì¸í•˜ê¸° ìœ„í•´ì„œë„ ì„œë²„ì™€ í†µì‹ ì„ í•œë‹¤. ì–´ì¨ŒëŠ” ì•±ì„ ì¼¤ ë•Œ í†µì‹ ì„ í•˜ê²Œ ë˜ë©´ì„œ ë°”ë¡œ ì•±ì´ ì£½ì–´ë²„ë¦¬ëŠ” ê²ƒì´ì—ˆë‹¤. ì¦‰ í†µì‹  ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œì— ëŒ€í•œ ëŒ€ì²˜ê°€ ì•ˆ ë˜ì–´ ìˆì—ˆë˜ ê²ƒì´ë‹¤.

## í•´ê²° ë°©ë²• ì°¾ì•„ë³´ê¸°

---

ë°°í¬ ì „ì— ì´ëŸ° ë¬¸ì œê°€ ë°œìƒí•´ì„œ ë‹¤í–‰ì´ë¼ê³  ìƒê°í•˜ê³  í•´ê²° ë°©ë²•ì„ ì°¾ì•„ë³´ê³ ì í–ˆë‹¤.

ì´ë¯¸ ì„ ë°° ê°œë°œìë“¤ì´ ìˆ˜ì—†ì´ ê²ªì€ ë¬¸ì œì´ê³  ìµœì ì˜ ë°©ë²•ìœ¼ë¡œ í•´ê²°í–ˆì„ ê±°ë¼ ê¸°ëŒ€í•˜ê³  êµ¬ê¸€ë§ì„ í–ˆë‹¤.

ê·¸ ì¤‘ í•œ [ë¸”ë¡œê·¸]ê°€ ëˆˆì— ë„ì—ˆë‹¤. (ì‚¬ì‹¤ ì´ì „ì— í•œ ë²ˆ ì½ì–´ë´¤ë˜ ê¸€ì´ì—ˆë‹¤) ë°”ë¡œ ê·¸ ìœ ëª…í•œ skydoves ë‹˜ì˜ ê¸€ì´ì—ˆë‹¤. í•´ë‹¹ ê¸€ì—ì„œëŠ” `Retrofit`ì„ ì‚¬ìš©í•œ í†µì‹  ì¤‘ ë°œìƒí•˜ëŠ” ì—ëŸ¬ë‚˜ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•  ë•Œì˜ ë¬¸ì œì ì´ë‚˜ ì•„í‚¤í…ì²˜ ê´€ì ì˜ ë¬¸ì œì , ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ë“±ì— ëŒ€í•´ ì„¤ëª…í•˜ê³ , ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `Sandwich`ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°œë°œí–ˆë‹¤ê³  ì„¤ëª…í•œë‹¤. ë‚˜ëŠ” `sandwich`ë¥¼ ì‚¬ìš©í•´ Suwikiì˜ ë„¤íŠ¸ì›Œí‚¹ ë¬¸ì œë„ í•´ê²°í•˜ê³ ì í–ˆë‹¤.

## í•´ê²°í•´ë³´ì

---

### ì˜ì¡´ì„± ì¶”ê°€

```gradle
dependencies {
    implementation "com.github.skydoves:sandwich:1.2.5"
}
```

### ì‘ë‹µ ë˜í¼ í´ë˜ìŠ¤ ë³€ê²½ (Response -> ApiResponse)

ê¸°ì¡´ì˜ ëŒ€ë¶€ë¶„ì˜ API ì‘ë‹µì€ `Retrofit`ì˜ `Response`ë¡œ ê°ì‹¸ì ¸ ìˆì—ˆë‹¤. ì´ë¥¼ `sandwich`ì—ì„œ ì œê³µí•˜ëŠ” `ApiResponse`ë¡œ ë³€ê²½í•œë‹¤.

`ApiResponse`ëŠ” ì•„ì£¼ ê°„ë‹¨í•œ í˜•íƒœë¡œ í†µì‹  ì„±ê³µ ìƒí™©ì—ì„œì˜ body dataë‚˜ ì˜ˆì™¸ ìƒí™©ì—ì„œì˜ í˜ì´ë¡œë“œ ë“±ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

ë‚´ë¶€ë¥¼ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ sealed classë¡œ ë§Œë“¤ì–´ì ¸ ìˆë‹¤. (ì¶”ìƒí™” ëœ ì½”ë“œ)

```kotlin
public sealed class ApiResponse<out T> {
  public data class Success<T>(val response: Response<T>) : ApiResponse<T>() {
    val data: List<Poster>? = response.data
    val statusCode: StatusCode = response.statusCode
    val headers: Headers = response.headers
  }
  public sealed class Failure<T> {
    public data class Error<T>(val response: Response<T>) : ApiResponse<T>() {
      val message: String = response.message()
      val errorBody: ResponseBody? = response.errorBody
      val statusCode: StatusCode = response.statusCode
      val headers: Headers = response.headers
    }
    public data class Exception<T>(val exception: Throwable) : ApiResponse<T>() {
      val message: String? = exception.localizedMessage
    }
  }
  // ...
}
```

Successì™€ Failureê°€ ìˆê³ , FailureëŠ” ë‹¤ì‹œ Errorì™€ Exceptionìœ¼ë¡œ êµ¬ë¶„ëœë‹¤. Errorì™€ Exceptionì„ sealed classë¡œ ë¬¶ìŒìœ¼ë¡œì¨ Errorì™€ Exceptionì„ í•œ ë²ˆì— ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì¥ì ë„ ì±™ê²¼ë‹¤. ğŸ‘ğŸ‘

ë‚´ê°€ ì§ë©´í•œ ë¬¸ì œëŠ” Exception ì—ì„œ ì²˜ë¦¬ ë˜ì–´ì•¼ í•  ê²ƒì´ë‹¤.

### Call Adapter Factory ì¶”ê°€

```kotlin
.addCallAdapterFactory(ApiResponseCallAdapterFactory.create())
```

ìœ„ ì½”ë“œë¥¼ `Retrofit.Builder`ì— ì¶”ê°€í•œë‹¤.

![retrofit.builder](https://user-images.githubusercontent.com/44221447/173775163-5bfe8b29-0762-41fe-97b8-6f22e3fc4135.png)

### ê¸°ì¡´ ì½”ë“œ ëŒ€ì‘

DataSource ì¸í„°í˜ì´ìŠ¤ë‚˜ êµ¬í˜„ì²´ì¸ RemoteDataSource, ê·¸ë¦¬ê³  Repository, ViewModel ë“± ê¸°ì¡´ì˜ Responseë¡œ ì‘ë‹µ íƒ€ì…ì´ ë˜ì–´ìˆë˜ ë¶€ë¶„ì„ ApiResponseë¡œ ë³€ê²½í•´ì¤€ë‹¤.

![dataSource](https://user-images.githubusercontent.com/44221447/173776416-b87953aa-b490-4655-bcc5-0bc18683e4f1.png)

ì„±ê³µ, ì‹¤íŒ¨ ë¶„ê¸°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë‘ ê°€ì§€ í˜•íƒœë¡œ í•  ìˆ˜ ìˆë‹¤.

```kotlin
CoroutineScope(Dispatchers.IO).launch {
    val response = IRetrofit.getInstance().getUserData()
    response.onSuccess {
        // ë¡œê·¸ì¸
    }.onFailure {
        Log.e(TAG, "User - login() failed: $this")
        error.postValue("ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")
    }
}
```

```kotlin
CoroutineScope(Dispatchers.IO).launch {
    val response = IRetrofit.getInstance().getUserData()
    when(response) {
        is Success -> { /* ë¡œê·¸ì¸ */ }
        is ApiResponse.Failure.Error -> // ì—ëŸ¬ ì‘ë‹µ ì²˜ë¦¬
        is ApiResponse.Failure.Exception -> // ì˜ˆì™¸ ì²˜ë¦¬
    }
}
```

### ì•± êµ¬ë™ ì„±ê³µ

ë„¤íŠ¸ì›Œí¬ ì˜ˆì™¸ë¡œ ì‹œì‘ê³¼ ë™ì‹œì— í„°ì§€ë˜ ê²ƒê³¼ ë‹¬ë¦¬ ì´ì œëŠ” ì•±ì„ ì¼¤ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤. ë¬¼ë¡  ì„œë²„ ë¬¸ì œê°€ í•´ê²°ëœ ê²ƒì€ ì•„ë‹ˆë¼ì„œ ì•„ì§ API ìš”ì²­ì´ ë¶ˆê°€í•´ ì œëŒ€ë¡œ ëœ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ ìµœì†Œí•œ ì•±ì„ ê·¸ëƒ¥ ì£½ì—¬ë²„ë¦¬ëŠ” ê²ƒì´ ì•„ë‹Œ ì–´ë–¤ ìƒí™©ì¸ì§€ ìœ ì €ì—ê²Œ ì•Œë¦´ ìˆ˜ ìˆê²Œ ë˜ì—ˆìœ¼ë©°, ì˜ˆìƒì¹˜ ëª»í•œ ìƒí™©ì—ì„œë„ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ë“¤ì€ ê³„ì†í•´ì„œ ì œê³µí•  ìˆ˜ ìˆëŠ” ë²„ê·¸ í”½ìŠ¤ê°€ ë˜ì—ˆë‹¤.

ì„œë²„ í†µì‹ ì´ ë¶ˆê°€í•œ ìƒí™©ì—ì„œ ì–´ë–¤ ì‹ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¬ê³ , ê¸°ëŠ¥ì„ ì œê³µí•´ ì¤„ ì§€ì— ëŒ€í•œ ë°©ë²•ì„ ê³ ë¯¼í•´ì•¼ í•  ê²ƒì´ë‹¤.

## ê²°ë¡ 

---

sandwich ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ ê°„ë‹¨í•˜ê²Œ ë„¤íŠ¸ì›Œí‚¹ ì‹¤íŒ¨ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆì—ˆë‹¤. ì—¬ê¸°ì„œ ì†Œê°œí•œ ë‚´ìš©ì€ ì•„ì£¼ ì•„ì£¼ ê¸°ë³¸ì ì¸ ë‚´ìš©ë§Œ ìˆì§€ë§Œ sandwichëŠ” Flowë¥¼ ì‚¬ìš©í•˜ëŠ” í™˜ê²½ ë“± ì•„ì£¼ ë‹¤ì–‘í•œ ìƒí™©ì„ ì»¤ë²„í•  ìˆ˜ ìˆë„ë¡ ì •êµí•˜ê²Œ ë§Œë“¤ì–´ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤ ë³´ë‹ˆ ì¢€ ë” ê³µë¶€í•˜ê³  ìµœì ì˜ ë°©ë²•ì„ ì ìš©í•´ë³´ë ¤ í•œë‹¤. ë¬¼ë¡  í¸ë¦¬í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ì— ì‹¤ì œ ë„¤íŠ¸ì›Œí‚¹ì´ ì–´ë–»ê²Œ ì´ë£¨ì–´ì§€ê³  ì–´ë–»ê²Œ ì—ëŸ¬ë¥¼ í•¸ë“¤ë§í•´ì•¼ í•  ì§€ ê³ ë¯¼í•´ë³´ëŠ” ê²ƒì„ ë®ì–´ë‘ì§€ ì•Šìœ¼ë¦¬ë¼ ë‹¤ì§í•˜ë©° ê¸€ì„ ë§ˆì¹œë‹¤.

## ì°¸ê³ 

[https://velog.io/@skydoves/retrofit-api-handling-sandwich][ë¸”ë¡œê·¸]
[https://github.com/skydoves/sandwich][ê¹ƒí—™]

[ë¸”ë¡œê·¸]: https://velog.io/@skydoves/retrofit-api-handling-sandwich
[ê¹ƒí—™]: https://github.com/skydoves/sandwich
